(function(a,s){typeof exports=="object"&&typeof module<"u"?module.exports=s():typeof define=="function"&&define.amd?define(s):(a=typeof globalThis<"u"?globalThis:a||self,a.EhOnScrollColorSwitcher=s())})(this,function(){"use strict";const a=t=>{var e;if(!t)return;if((t==null?void 0:t.color)!=""&&t[0]==="#")return t;const r=(e=t.match(/(--.*[^/)])/g))==null?void 0:e[0];return getComputedStyle(document.documentElement).getPropertyValue(r).trim()},s=(t=>r=>{try{t.querySelector(r)}catch{return!1}return!0})(document.createDocumentFragment());gsap.registerPlugin(ScrollTrigger);class p{constructor(r){this.options=r,this.items=r.items,this.elements=[],this.init()}init(){this.cleanupMarkup(),this.cleanupGsapState(),this.createMarkup(),this.setupElements(),this.elements.length>0&&this.setupTriggers()}cleanupMarkup(){var r;(r=document.querySelector(`.${this.options.containerClassName}`))==null||r.remove()}createMarkup(){var r;this.backgroundContainer=document.createElement("div"),this.backgroundContainer.classList.add(this.options.containerClassName),this.options.isBuilder?(r=document.querySelector("#breakdance_canvas"))==null||r.insertAdjacentElement("afterbegin",this.backgroundContainer):document.body.insertAdjacentElement("afterbegin",this.backgroundContainer)}setupElements(){!this.items||this.items.length!==0&&this.items.forEach((r,e)=>{var n,c,u,l,g,d;if(!s((n=r.background_color_trigger)==null?void 0:n.selector))return;const o=document.querySelector((c=r.background_color_trigger)==null?void 0:c.selector);let i=null;if(s((u=r.color_target)==null?void 0:u.selector)&&(i=document.querySelectorAll((l=r.color_target)==null?void 0:l.selector),i.length>0&&i.forEach(h=>{h.dataset.ehPreviousColor=getComputedStyle(h).color})),!o)return;const f={scrollTriggerId:`${this.options.containerClassName}-${e}`,triggerPosition:r.viewport_trigger_location||20,targetBgColor:a(r.background_color_trigger.background_color),previousBgColor:e===0?"":a(this.items[e-1].background_color_trigger.background_color),targetColor:a((g=r.color_target)==null?void 0:g.color),duration:((d=r.transition_duration)==null?void 0:d.number)||.4,backgroundTarget:o,colorTargets:i};this.elements.push(f)})}setupTriggers(){this.elements.forEach((r,e)=>{ScrollTrigger.create({id:r.scrollTriggerId,trigger:r.backgroundTarget,start:`top ${100-r.triggerPosition}%`,onEnter:()=>{const o=gsap.timeline({ease:"power1.inOut"});o.to(this.backgroundContainer,{backgroundColor:r.targetBgColor,overwrite:"auto",duration:r.duration},0),r.colorTargets&&r.colorTargets.forEach(i=>{o.to(i,{color:r.targetColor,overwrite:"auto",duration:r.duration},0)})},onLeaveBack:()=>{const o=gsap.timeline();o.to(this.backgroundContainer,{backgroundColor:r.previousBgColor,overwrite:"auto",duration:r.duration},0),r.colorTargets&&r.colorTargets.forEach(i=>{o.to(i,{color:i.dataset.ehPreviousColor,overwrite:"auto",duration:r.duration},0)})}})})}cleanupGsapState(){this.elements.forEach(r=>{var e;(e=ScrollTrigger.getById(r.scrollTriggerId))==null||e.kill(!0),gsap.set(this.backgroundContainer,{clearProps:"all"}),r.colorTargets&&r.colorTargets.forEach(o=>{gsap.set(o,{clearProps:"all"})})})}destroy(){this.cleanupGsapState(),this.cleanupMarkup()}}return p});
