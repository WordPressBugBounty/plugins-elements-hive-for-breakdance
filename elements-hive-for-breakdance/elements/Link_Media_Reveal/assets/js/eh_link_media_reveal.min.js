(function(i,s){typeof exports=="object"&&typeof module<"u"?module.exports=s():typeof define=="function"&&define.amd?define(s):(i=typeof globalThis<"u"?globalThis:i||self,i.EhLinkMediaReveal=s())})(this,function(){"use strict";var h=Object.defineProperty;var r=(i,s,e)=>s in i?h(i,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[s]=e;var n=(i,s,e)=>(r(i,typeof s!="symbol"?s+"":s,e),e);class i{constructor(e){n(this,"onMouseEnter",()=>{this.showImage(),this.firstRAFCycle=!0,this.outerEl.style.transformOrigin=`50% ${this.mouseArea==="up"?0:100}%`,this.loopRender()});n(this,"onMouseLeave",()=>{this.stopRendering(),this.hideImage()});n(this,"onMouseMove",e=>{this.mousepos.x=this.isTouchDevice?e.touches[0].clientX:e.clientX,this.mousepos.y=this.isTouchDevice?e.touches[0].clientY:e.clientY});n(this,"destroy",()=>new Promise(e=>{var t;this.container.removeEventListener("mouseenter",this.onMouseEnter),this.container.removeEventListener("mouseleave",this.onMouseLeave),this.container.removeEventListener("mousemove",this.onMouseMove),gsap.set([this.outerEl,this.innerEl,this.mediaEl],{clearProps:"all"}),(t=this.tl)==null||t.kill(),this.tl=null,e()}));this.container=e.containerEl,this.outerEl=e.outerEl,this.innerEl=e.innerEl,this.mediaEl=e.mediaEl,this.mediaType=e.mediaType,this.centerMedia=e.centerMedia,this.animatableProps=e.animatableProps,this.timelineProps=e.timelineProps,this.isBuilderMode=e.isBuilderMode||!1,this.mousepos={x:0,y:0},this.mousePosCache=this.mousepos,this.direction={x:this.mousePosCache.x-this.mousepos.x,y:this.mousePosCache.y-this.mousepos.y},this.isTouchDevice="ontouchstart"in window,this.loadMedia()}loadMedia(){this.mediaEl.src=this.mediaEl.dataset.ehSrc,this.mediaType=="video"&&(this.mediaEl.muted=!0,this.mediaEl.crossOrigin="Anonymous",this.mediaEl.load()),this.mediaEl.onload=this.init()}calcBounds(){this.bounds={el:this.container.getBoundingClientRect(),reveal:this.outerEl.getBoundingClientRect()}}getMouseArea(){return this.bounds.el.top+this.bounds.el.height/2<=window.innerHeight/2?"up":"down"}init(){this.isTouchDevice?(this.container.addEventListener("touchstart",this.onMouseEnter,{passive:!0}),this.container.addEventListener("touchend",this.onMouseLeave,{passive:!0}),this.container.addEventListener("touchcancel",this.onMouseLeave,{passive:!0}),this.container.addEventListener("touchmove",this.onMouseMove,{passive:!0})):(this.container.addEventListener("mouseenter",this.onMouseEnter),this.container.addEventListener("mouseleave",this.onMouseLeave),this.container.addEventListener("mousemove",this.onMouseMove))}showImage(){gsap.killTweensOf(this.innerEl),gsap.killTweensOf(this.mediaEl),this.tl=gsap.timeline({onStart:()=>{gsap.set([this.outerEl,this.innerEl],{delay:.1,opacity:1}),gsap.set(this.container,{zIndex:1e3}),this.mediaType=="video"&&this.mediaEl.play()}}),this.timelineProps.show.inner&&this.tl.to(this.innerEl,{...this.timelineProps.show.inner}),this.timelineProps.show.media&&this.tl.to(this.mediaEl,{...this.timelineProps.show.media},0)}hideImage(){gsap.killTweensOf(this.innerEl),gsap.killTweensOf(this.mediaEl),this.tl=gsap.timeline({onStart:()=>{gsap.set(this.container,{zIndex:"inherit"})},onComplete:()=>{gsap.set(this.outerEl,{opacity:0}),this.mediaType=="video"&&(this.mediaEl.pause(),this.mediaEl.currentTime=0)}}),this.timelineProps.hide.inner&&this.tl.to(this.innerEl,{...this.timelineProps.hide.inner})}loopRender(){this.requestId||(this.requestId=requestAnimationFrame(this.render.bind(this)))}stopRendering(){this.requestId&&(window.cancelAnimationFrame(this.requestId),this.requestId=void 0)}render(){this.requestId=void 0,this.firstRAFCycle&&(this.calcBounds(),this.mouseArea=this.getMouseArea());const e={x:this.animatableProps.tx.previous,y:this.animatableProps.ty.previous},t=gsap.utils.clamp(Math.abs(this.mousePosCache.x-this.mousepos.x),0,100);this.direction={x:this.mousePosCache.x-this.mousepos.x,y:this.mousePosCache.y-this.mousepos.y},this.mousePosCache={x:this.mousepos.x,y:this.mousepos.y},this.animatableProps.tx.current=this.centerMedia?Math.abs(this.mousepos.x-this.bounds.el.left)-this.bounds.reveal.width/2:Math.abs(this.mousepos.x-this.bounds.el.left),this.animatableProps.ty.current=this.mouseArea==="up"?Math.abs(this.mousepos.y-this.bounds.el.top):Math.abs(this.mousepos.y-this.bounds.el.top)-this.bounds.reveal.height,this.animatableProps.rotation&&(this.animatableProps.rotation.current=this.firstRAFCycle?0:gsap.utils.mapRange(0,100,0,this.direction.x<0?45:-45,t)),this.animatableProps.scale&&(this.animatableProps.scale.current=this.firstRAFCycle?1:gsap.utils.mapRange(0,40,1,1.5,t));for(const o in this.animatableProps)this.animatableProps[o].previous=this.firstRAFCycle?this.animatableProps[o].current:gsap.utils.interpolate(this.animatableProps[o].previous,this.animatableProps[o].current,this.animatableProps[o].amt);this.animatableProps.rotation&&(e.rotation=this.animatableProps.rotation.previous);const a={};this.animatableProps.scale&&(a.scaleX=this.animatableProps.scale.previous,a.scaleY=gsap.utils.mapRange(1,5,1,.1,this.animatableProps.scale.previous)),gsap.set(this.outerEl,{...e}),this.animatableProps.scale&&gsap.set(this.mediaEl,{...a}),this.firstRAFCycle=!1,this.loopRender()}}return i});
